<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Jujutsu Battle: Professional Edition</title>
    <style>
        :root { --p-color: #00d4ff; --e-color: #ff4e50; }
        body { background: #050505; color: white; font-family: 'Meiryo', sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; }
        #game-board { width: 850px; height: 500px; background: #111; position: relative; border: 4px solid #333; overflow: hidden; }
        
        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ */
        .unit { position: absolute; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); text-align: center; width: 100px; }
        .unit-icon { font-size: 60px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); }
        .hp-gauge { width: 80px; height: 6px; background: #333; margin: 5px auto; border-radius: 3px; }
        .hp-fill { height: 100%; background: #2ecc71; width: 100%; transition: 0.3s; }
        
        /* é…ç½® */
        #p0 { bottom: 150px; left: 100px; }
        #p1 { bottom: 120px; left: 220px; }
        #p2 { bottom: 90px; left: 340px; }
        #boss { top: 100px; right: 150px; scale: 1.5; }

        /* UIã‚¨ãƒªã‚¢ */
        #ui-panel { width: 850px; background: #1a1a1a; padding: 15px; display: grid; grid-template-columns: repeat(3, 1fr) 150px; gap: 10px; border: 2px solid #333; }
        .char-cmd { background: #252525; padding: 8px; border-radius: 5px; border-top: 3px solid var(--p-color); }
        .char-cmd.done { border-top-color: #555; opacity: 0.6; }
        select { width: 100%; padding: 5px; background: #333; color: white; border: none; margin-top: 5px; }
        
        #go-btn { background: var(--e-color); color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; font-size: 20px; }
        #go-btn:disabled { background: #444; }

        /* ãƒ­ã‚°æ¼”å‡º */
        #battle-log { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; font-size: 14px; pointer-events: none; }
    </style>
</head>
<body>

<div id="game-board">
    <div id="battle-log">ã‚³ãƒãƒ³ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„...</div>
    <div id="boss" class="unit">
        <div class="hp-gauge"><div id="hp-e" class="hp-fill"></div></div>
        <div class="unit-icon">ğŸŒ‹</div>
    </div>
    <div id="p0" class="unit"><div class="hp-gauge"><div id="hp-p0" class="hp-fill"></div></div><div class="unit-icon">ğŸ‘Š</div></div>
    <div id="p1" class="unit"><div class="hp-gauge"><div id="hp-p1" class="hp-fill"></div></div><div class="unit-icon">ğŸ‘“</div></div>
    <div id="p2" class="unit"><div class="hp-gauge"><div id="hp-p2" class="hp-fill"></div></div><div class="unit-icon">ğŸ¥</div></div>
</div>

<div id="ui-panel">
    <div id="cmd-0" class="char-cmd"><strong>ã‚¢ã‚¿ãƒƒã‚«ãƒ¼</strong><select id="sel-0"><option value="atk">å‘ªæ’ƒ</option><option value="skill">é»’é–ƒ (æ¶ˆè²»20)</option></select></div>
    <div id="cmd-1" class="char-cmd"><strong>ãƒãƒ•æ‹…å½“</strong><select id="sel-1"><option value="buff">æˆ¦æ„é«˜æš</option></select></div>
    <div id="cmd-2" class="char-cmd"><strong>ãƒ’ãƒ¼ãƒ©ãƒ¼</strong><select id="sel-2"><option value="heal">åè»¢è¡“å¼</option></select></div>
    <button id="go-btn" onclick="startPhase()">å®Ÿè¡Œ</button>
</div>

<script>
    // --- 1. è¨­è¨ˆå›³ï¼ˆã‚¯ãƒ©ã‚¹ï¼‰ ---
    class Unit {
        constructor(id, name, hp, type) {
            this.id = id;
            this.name = name;
            this.hp = hp;
            this.maxHp = hp;
            this.type = type; // 'player' or 'enemy'
            this.buff = 1.0;
        }
        updateHP() {
            const fill = document.getElementById(`hp-${this.id}`);
            fill.style.width = (this.hp / this.maxHp * 100) + "%";
        }
    }

    // --- 2. åˆæœŸåŒ– ---
    const players = [
        new Unit("p0", "ã‚¢ã‚¿ãƒƒã‚«ãƒ¼", 150, "player"),
        new Unit("p1", "ãƒãƒ•æ‹…å½“", 100, "player"),
        new Unit("p2", "ãƒ’ãƒ¼ãƒ©ãƒ¼", 80, "player")
    ];
    const enemy = new Unit("e", "ç‰¹ç´šå‘ªéœŠ", 1000, "enemy");

    const log = (msg) => document.getElementById('battle-log').innerText = msg;

    // --- 3. ãƒãƒˆãƒ«ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã“ã“ãŒé›£ã—ã„ï¼ï¼‰ ---
    async function startPhase() {
        document.getElementById('go-btn').disabled = true;

        // å‘³æ–¹ã®è¡Œå‹•
        for (let i = 0; i < players.length; i++) {
            if (enemy.hp <= 0) break;
            const action = document.getElementById(`sel-${i}`).value;
            await executeAction(players[i], action);
        }

        // æ•µã®è¡Œå‹•
        if (enemy.hp > 0) {
            await new Promise(r => setTimeout(r, 800));
            await enemyAction();
        }

        document.getElementById('go-btn').disabled = false;
        log("æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„...");
    }

    async function executeAction(actor, type) {
        log(`${actor.name}ã®è¡Œå‹•ï¼`);
        const el = document.getElementById(actor.id);
        
        if (type === 'atk' || type === 'skill') {
            el.style.transform = "translateX(50px)";
            let dmg = type === 'atk' ? 40 : 120;
            dmg = Math.floor(dmg * actor.buff);
            enemy.hp = Math.max(0, enemy.hp - dmg);
            enemy.updateHP();
            actor.buff = 1.0; // ãƒãƒ•æ¶ˆè²»
            log(`${enemy.name}ã« ${dmg} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
        } else if (type === 'buff') {
            el.style.transform = "translateY(-20px)";
            players[0].buff = 2.0;
            log(`ã‚¢ã‚¿ãƒƒã‚«ãƒ¼ã®åŠ›ã‚’å¼·åŒ–ï¼`);
        } else if (type === 'heal') {
            el.style.transform = "translateY(-20px)";
            players.forEach(p => { p.hp = Math.min(p.maxHp, p.hp + 30); p.updateHP(); });
            log(`å‘³æ–¹å…¨å“¡ã‚’å›å¾©ï¼`);
        }

        await new Promise(r => setTimeout(r, 600));
        el.style.transform = "translate(0,0)";
    }

    async function enemyAction() {
        log(`æ•µã®æ”»æ’ƒï¼`);
        const target = players[Math.floor(Math.random() * players.length)];
        document.getElementById('boss').style.transform = "translateX(-100px)";
        
        target.hp = Math.max(0, target.hp - 40);
        target.updateHP();
        
        await new Promise(r => setTimeout(r, 600));
        document.getElementById('boss').style.transform = "translateX(0)";
        log(`${target.name}ã¯ 40 ãƒ€ãƒ¡ãƒ¼ã‚¸å—ã‘ãŸï¼`);
    }
</script>
</body>
</html>