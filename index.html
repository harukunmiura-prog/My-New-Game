<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Jujutsu Battle: Ultra Edition</title>
    <style>
        body { background: #000; color: #eee; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; }
        #game-viewport { width: 800px; height: 450px; background: #111; position: relative; border: 5px solid #222; overflow: hidden; }
        
        /* æºã‚Œæ¼”å‡ºç”¨ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .shake { animation: shake 0.2s; }
        @keyframes shake {
            0% { transform: translate(1px, 1px); }
            20% { transform: translate(-3px, 0); }
            40% { transform: translate(3px, 2px); }
            100% { transform: translate(0, 0); }
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ */
        .char { position: absolute; transition: 0.4s; text-align: center; width: 100px; }
        .icon { font-size: 50px; }
        .status-bar { width: 80px; background: #333; height: 5px; margin: 2px auto; border-radius: 3px; }
        .hp-inner { height: 100%; background: #2ecc71; width: 100%; transition: 0.3s; }
        .mp-inner { height: 100%; background: #00d4ff; width: 0%; transition: 0.3s; }

        /* é…ç½® */
        #p0 { bottom: 120px; left: 80px; }
        #p1 { bottom: 100px; left: 190px; }
        #p2 { bottom: 80px; left: 300px; }
        #enemy { top: 80px; right: 120px; scale: 1.8; }

        /* UI */
        #control-panel { width: 800px; background: #1a1a1a; display: grid; grid-template-columns: repeat(3, 1fr) 120px; gap: 10px; padding: 15px; box-sizing: border-box; }
        .panel-unit { background: #222; padding: 10px; border-radius: 5px; font-size: 12px; }
        select { width: 100%; margin-top: 5px; background: #333; color: white; border: 1px solid #444; padding: 3px; }
        button { background: #ff4e50; color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; }
        button:disabled { background: #555; }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="enemy" class="char"><div class="status-bar"><div id="hp-e" class="hp-inner"></div></div><div class="icon">ğŸ‘¹</div></div>
    <div id="p0" class="char">
        <div class="status-bar"><div id="hp-p0" class="hp-inner"></div></div>
        <div class="status-bar"><div id="mp-p0" class="mp-inner"></div></div>
        <div class="icon">ğŸ¤œ</div>
    </div>
    <div id="p1" class="char">
        <div class="status-bar"><div id="hp-p1" class="hp-inner"></div></div>
        <div class="status-bar"><div id="mp-p1" class="mp-inner"></div></div>
        <div class="icon">ğŸ‘“</div>
    </div>
    <div id="p2" class="char">
        <div class="status-bar"><div id="hp-p2" class="hp-inner"></div></div>
        <div class="status-bar"><div id="mp-p2" class="mp-inner"></div></div>
        <div class="icon">ğŸ¥</div>
    </div>
</div>

<div id="control-panel">
    <div class="panel-unit">ã‚¢ã‚¿ãƒƒã‚«ãƒ¼<select id="act0"><option value="atk">å‘ªæ’ƒ(+20MP)</option><option value="skill">é»’é–ƒ(20MPæ¶ˆè²»)</option></select></div>
    <div class="panel-unit">ãƒãƒ•æ‹…å½“<select id="act1"><option value="atk">å‘ªæ’ƒ(+20MP)</option><option value="buff">æˆ¦æ„é«˜æš(20MPæ¶ˆè²»)</option></select></div>
    <div class="panel-unit">ãƒ’ãƒ¼ãƒ©ãƒ¼<select id="act2"><option value="atk">å‘ªæ’ƒ(+20MP)</option><option value="heal">åè»¢è¡“å¼(40MPæ¶ˆè²»)</option></select></div>
    <button id="btn-go" onclick="runTurn()">å®Ÿè¡Œ</button>
</div>

<script>
class Fighter {
    constructor(id, name, hp, mp) {
        this.id = id;
        this.name = name;
        this.hp = hp; this.maxHp = hp;
        this.mp = mp;
        this.buff = 1;
    }
    update() {
        document.getElementById(`hp-${this.id}`).style.width = (this.hp/this.maxHp*100) + "%";
        const mpBar = document.getElementById(`mp-${this.id}`);
        if(mpBar) mpBar.style.width = this.mp + "%";
    }
}

const players = [new Fighter("p0", "è™æ–", 150, 0), new Fighter("p1", "ä¸ƒæµ·", 120, 0), new Fighter("p2", "å®¶å…¥", 100, 0)];
const boss = new Fighter("e", "ç‰¹ç´š", 1200, 0);

async function runTurn() {
    document.getElementById('btn-go').disabled = true;

    for(let i=0; i<3; i++) {
        if(boss.hp <= 0) break;
        const move = document.getElementById(`act${i}`).value;
        const p = players[i];

        // MPãƒã‚§ãƒƒã‚¯
        if((move==='skill' || move==='buff') && p.mp < 20) { alert(`${p.name}ã®MPãŒè¶³ã‚Šãªã„ï¼`); continue; }
        if(move==='heal' && p.mp < 40) { alert(`${p.name}ã®MPãŒè¶³ã‚Šãªã„ï¼`); continue; }

        await perform(p, move);
    }

    if(boss.hp > 0) await enemyTurn();
    document.getElementById('btn-go').disabled = false;
}

async function perform(p, move) {
    const el = document.getElementById(p.id);
    if(move === 'atk' || move === 'skill') {
        el.style.transform = "translateX(60px)";
        let d = move === 'atk' ? 50 : 150;
        d *= p.buff; p.buff = 1;
        boss.hp -= d; boss.update();
        if(move === 'atk') p.mp = Math.min(100, p.mp + 20); else p.mp -= 20;
        shake('enemy');
    } else if(move === 'buff') {
        p.mp -= 20; players[0].buff = 2.5;
        el.style.transform = "translateY(-20px)";
    } else if(move === 'heal') {
        p.mp -= 40; players.forEach(v => { v.hp = Math.min(v.maxHp, v.hp + 50); v.update(); });
        el.style.transform = "translateY(-20px)";
    }
    p.update();
    await new Promise(r => setTimeout(r, 600));
    el.style.transform = "";
}

async function enemyTurn() {
    const target = players[Math.floor(Math.random()*3)];
    document.getElementById('enemy').style.transform = "translateX(-80px)";
    target.hp = Math.max(0, target.hp - 40);
    target.update();
    shake(target.id);
    await new Promise(r => setTimeout(r, 600));
    document.getElementById('enemy').style.transform = "";
}

function shake(id) {
    const el = document.getElementById(id);
    el.classList.add('shake');
    setTimeout(() => el.classList.remove('shake'), 200);
}
</script>
</body>
</html>
