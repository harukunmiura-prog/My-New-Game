<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Jujutsu: Complete System</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; text-align: center; overflow: hidden; }
        .scene { display: none; width: 800px; height: 550px; margin: 10px auto; border: 4px solid #333; position: relative; background: #0a0a0f; }
        .active { display: flex; flex-direction: column; }
        
        /* ãƒ­ãƒ“ãƒ¼ & UI */
        .menu-btn { padding: 12px 25px; margin: 10px; font-size: 18px; cursor: pointer; background: #e74c3c; color: white; border: none; border-radius: 5px; }
        .back-btn { position: absolute; top: 10px; left: 10px; padding: 5px 15px; background: #555; color: white; border: none; cursor: pointer; z-index: 10; }

        /* ã‚¬ãƒãƒ£ãƒ»ç·¨æˆ */
        .character-list { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 20px; }
        .char-card { border: 2px solid #444; padding: 10px; cursor: pointer; background: #222; }
        .char-card.selected { border-color: #00d4ff; background: #003344; }

        /* ãƒãƒˆãƒ«ç”»é¢ç”¨ */
        #battle-field { height: 350px; position: relative; background: linear-gradient(to bottom, #1a1a2e, #000); border-bottom: 2px solid #444; }
        .unit { position: absolute; transition: 0.3s; text-align: center; }
        .bars { width: 80px; height: 6px; background: #222; margin: 2px auto; border-radius: 3px; overflow: hidden; }
        .hp-fill { height: 100%; background: #2ecc71; width: 100%; transition: 0.3s; }
        #ui-bottom { height: 200px; background: #111; display: grid; grid-template-columns: repeat(3, 1fr) 120px; gap: 10px; padding: 10px; }
    </style>
</head>
<body>

    <div id="scene-lobby" class="scene active">
        <h1>å‘ªè¡“é«˜å°‚ï¼šãƒ­ãƒ“ãƒ¼</h1>
        <div style="margin-top: 100px;">
            <button class="menu-btn" onclick="changeScene('scene-gacha')">ã‚¬ãƒãƒ£ï¼ˆã‚­ãƒ£ãƒ©å…¥æ‰‹ï¼‰</button>
            <button class="menu-btn" onclick="changeScene('scene-party')">ç·¨æˆï¼ˆ3äººé¸æŠï¼‰</button>
            <button id="start-battle-btn" class="menu-btn" style="background:#2ecc71;" onclick="startBattle()">ä»»å‹™é–‹å§‹ï¼ˆãƒãƒˆãƒ«ï¼‰</button>
        </div>
    </div>

    <div id="scene-gacha" class="scene">
        <button class="back-btn" onclick="changeScene('scene-lobby')">æˆ»ã‚‹</button>
        <h2>ç‰¹ç´šã‚¬ãƒãƒ£</h2>
        <div id="gacha-res" style="font-size: 80px; margin: 50px;">ï¼Ÿ</div>
        <button class="menu-btn" onclick="pullGacha()">1å›å¼•ã</button>
    </div>

    <div id="scene-party" class="scene">
        <button class="back-btn" onclick="changeScene('scene-lobby')">æˆ»ã‚‹</button>
        <h2>ãƒãƒ¼ãƒ ç·¨æˆ</h2>
        <div id="my-chars" class="character-list"></div>
        <div id="party-info">é¸æŠä¸­: 0 / 3</div>
    </div>

    <div id="scene-battle" class="scene">
        <div id="battle-field">
            <div id="boss" class="unit" style="top:50px; right:100px; scale:1.5;">
                <div class="bars"><div id="hp-e" class="hp-fill"></div></div>
                <div style="font-size:60px">ğŸŒ‹</div>
            </div>
            <div id="p-units"></div> </div>
        <div id="ui-bottom">
            <div id="cmd-0"></div><div id="cmd-1"></div><div id="cmd-2"></div>
            <button id="go-btn" style="background:#e74c3c; color:white; border:none; font-weight:bold; cursor:pointer;" onclick="runBattleTurn()">ç¥“æ‰•</button>
        </div>
    </div>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿ ---
    const allChars = [
        { id: 'itadori', name: 'è™æ–', emoji: 'ğŸ¤œ', hp: 150 },
        { id: 'gojo', name: 'äº”æ¡', emoji: 'ğŸ˜', hp: 500 },
        { id: 'fushiguro', name: 'ä¼é»’', emoji: 'ğŸº', hp: 120 },
        { id: 'nanami', name: 'ä¸ƒæµ·', emoji: 'ğŸ“', hp: 140 },
        { id: 'kugisaki', name: 'é‡˜å´', emoji: 'ğŸ”¨', hp: 110 }
    ];
    let inventory = ['itadori'];
    let party = [];
    let enemyHP = 1000;

    // --- ã‚·ã‚¹ãƒ†ãƒ  ---
    function changeScene(id) {
        document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'scene-party') renderParty();
    }

    function pullGacha() {
        const res = allChars[Math.floor(Math.random()*allChars.length)];
        document.getElementById('gacha-res').innerText = res.emoji;
        if(!inventory.includes(res.id)) inventory.push(res.id);
    }

    function renderParty() {
        const list = document.getElementById('my-chars');
        list.innerHTML = '';
        inventory.forEach(id => {
            const data = allChars.find(c => c.id === id);
            const card = document.createElement('div');
            card.className = `char-card ${party.includes(id) ? 'selected' : ''}`;
            card.innerHTML = `<div style="font-size:30px">${data.emoji}</div>${data.name}`;
            card.onclick = () => {
                if(party.includes(id)) party = party.filter(p => p !== id);
                else if(party.length < 3) party.push(id);
                renderParty();
            };
            list.appendChild(card);
        });
        document.getElementById('party-info').innerText = `é¸æŠä¸­: ${party.length} / 3`;
    }

    // --- ãƒãƒˆãƒ«é–‹å§‹å‡¦ç†ï¼ˆåˆä½“ã®ã‚­ãƒ¢ï¼ï¼‰ ---
    function startBattle() {
        if(party.length < 1) return alert("ã¾ãšã¯ç·¨æˆã§ã‚­ãƒ£ãƒ©ã‚’é¸ã‚“ã§ã­ï¼");
        enemyHP = 1000;
        changeScene('scene-battle');
        
        const field = document.getElementById('p-units');
        field.innerHTML = '';
        party.forEach((id, i) => {
            const data = allChars.find(c => c.id === id);
            field.innerHTML += `
                <div id="unit-${i}" class="unit" style="bottom:${100 - i*30}px; left:${80 + i*100}px;">
                    <div class="bars"><div id="hp-p${i}" class="hp-fill"></div></div>
                    <div style="font-size:50px">${data.emoji}</div>
                </div>`;
            document.getElementById(`cmd-${i}`).innerHTML = `
                <div style="font-size:12px">${data.name}</div>
                <select id="sel-${i}"><option value="40">é€šå¸¸</option><option value="120">è¡“å¼</option></select>`;
        });
    }

    async function runBattleTurn() {
        document.getElementById('go-btn').disabled = true;
        for(let i=0; i<party.length; i++) {
            const dmg = parseInt(document.getElementById(`sel-${i}`).value);
            enemyHP -= dmg;
            document.getElementById('hp-e').style.width = (Math.max(0, enemyHP)/10) + "%";
            // ç°¡æ˜“ã‚¢ãƒ‹ãƒ¡
            document.getElementById(`unit-${i}`).style.transform = "translateX(50px)";
            await new Promise(r => setTimeout(r, 400));
            document.getElementById(`unit-${i}`).style.transform = "";
        }
        alert("æ•µã®åæ’ƒï¼ˆç°¡æ˜“ç‰ˆï¼‰ï¼");
        document.getElementById('go-btn').disabled = false;
        if(enemyHP <= 0) { alert("å‹åˆ©ï¼ãƒ­ãƒ“ãƒ¼ã«æˆ»ã‚Šã¾ã™"); changeScene('scene-lobby'); }
    }
</script>
</body>
</html>
