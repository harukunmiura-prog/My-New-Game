<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Jujutsu Battle: Ultimate Stage</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Impact', sans-serif; margin: 0; overflow: hidden; }
        #world { width: 800px; height: 500px; background: #050505; position: relative; border: 5px solid #333; }
        
        /* å¿…æ®ºæŠ€ã‚«ãƒƒãƒˆã‚¤ãƒ³ */
        #cut-in { 
            position: absolute; width: 100%; top: 40%; background: rgba(255,0,0,0.8); 
            color: white; font-size: 50px; text-align: center; transform: scaleX(0); 
            transition: 0.5s; z-index: 100; font-style: italic;
        }
        .cut-in-active { transform: scaleX(1) !important; }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ */
        .char { position: absolute; transition: 0.3s; text-align: center; }
        .hp-outer { width: 60px; height: 4px; background: #222; margin-bottom: 2px; }
        .hp-inner { height: 100%; background: #2ecc71; width: 100%; transition: 0.3s; }

        /* é…ç½®: æ•µã‚’2ä½“ã«ã™ã‚‹ */
        #e0 { top: 100px; right: 150px; font-size: 60px; }
        #e1 { top: 180px; right: 80px; font-size: 40px; }
        #p0 { bottom: 150px; left: 100px; font-size: 50px; }
        #p1 { bottom: 120px; left: 200px; font-size: 50px; }

        /* UI */
        #ui { position: absolute; bottom: 0; width: 100%; height: 120px; background: rgba(20,20,30,0.9); display: flex; }
        .log { flex: 1; padding: 10px; font-size: 12px; border-right: 1px solid #444; overflow-y: scroll; }
        .controls { width: 300px; padding: 10px; display: flex; flex-direction: column; gap: 5px; }
        button { background: #333; color: white; border: 1px solid #666; cursor: pointer; }
        button:hover { background: #555; }
    </style>
</head>
<body>

<div id="world">
    <div id="cut-in">é»’ é–ƒ ï¼ï¼</div>
    
    <div id="e0" class="char"><div class="hp-outer"><div id="hp-e0" class="hp-inner"></div></div>ğŸŒ‹</div>
    <div id="e1" class="char"><div class="hp-outer"><div id="hp-e1" class="hp-inner"></div></div>ğŸ‘»</div>

    <div id="p0" class="char"><div class="hp-outer"><div id="hp-p0" class="hp-inner"></div></div>ğŸ¤œ</div>
    <div id="p1" class="char"><div class="hp-outer"><div id="hp-p1" class="hp-inner"></div></div>ğŸ’‰</div>

    <div id="ui">
        <div id="log-box" class="log">ãƒãƒˆãƒ«é–‹å§‹ï¼ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸ã‚“ã§æ”»æ’ƒã€‚</div>
        <div class="controls">
            <select id="target-select"><option value="e0">æ•µA (å¤§)</option><option value="e1">æ•µB (å°)</option></select>
            <button onclick="playTurn('strike')">é€šå¸¸æ‰“æ’ƒ</button>
            <button onclick="playTurn('ultimate')" style="background: #a00;">å¿…æ®ºæŠ€ (MP100)</button>
        </div>
    </div>
</div>

<script>
    let mp = 0;
    let enemyHPs = { e0: 500, e1: 200 };

    async function playTurn(type) {
        const targetId = document.getElementById('target-select').value;
        const logBox = document.getElementById('log-box');
        
        if (type === 'ultimate') {
            if (mp < 100) return alert("å‘ªåŠ›ãŒè¶³ã‚Šãªã„ï¼");
            // ã‚«ãƒƒãƒˆã‚¤ãƒ³æ¼”å‡º
            const ci = document.getElementById('cut-in');
            ci.classList.add('cut-in-active');
            await new Promise(r => setTimeout(r, 800));
            ci.classList.remove('cut-in-active');
            
            enemyHPs[targetId] -= 200;
            mp = 0;
            logBox.innerHTML += `<div>å¿…æ®ºæŠ€ï¼${targetId}ã«200ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼</div>`;
        } else {
            enemyHPs[targetId] -= 40;
            mp = Math.min(100, mp + 30);
            logBox.innerHTML += `<div>æ‰“æ’ƒï¼${targetId}ã«40ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼</div>`;
        }

        // ç”»é¢æºã‚‰ã—
        document.getElementById('world').style.animation = "shake 0.2s";
        setTimeout(() => document.getElementById('world').style.animation = "", 200);

        update();
    }

    function update() {
        for (let id in enemyHPs) {
            const el = document.getElementById(`hp-${id}`);
            if (el) el.style.width = (Math.max(0, enemyHPs[id]) / (id === 'e0' ? 5 : 2)) + "%";
            if (enemyHPs[id] <= 0) document.getElementById(id).style.opacity = "0.3";
        }
    }
</script>
</body>
</html>
